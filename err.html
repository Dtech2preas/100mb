<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HTML to Live Website Converter</title>
<style>
  #previewContainer {
    border: 1px solid #000;
    height: 400px;
    width: 100%;
    position: relative;
  }
  #previewIframe {
    width: 100%;
    height: 100%;
    border: none;
  }
  #fullscreenBtn {
    position: absolute;
    top: 5px;
    right: 5px;
    z-index: 10;
  }
</style>
</head>
<body>

<h1>HTML to Live Website Converter</h1>

<!-- Step 1: Authentication (Now hidden, auto random between token1 and token2) -->
<div style="display:none;">
  <h2>Step 1: Authentication</h2>
  <div id="tokenOptionsContainer"></div>
</div>

<!-- Step 2: Input HTML -->
<div>
  <h2>Step 2: Input HTML</h2>
  <textarea id="htmlInput" rows="10" cols="80" placeholder="Paste your HTML here"></textarea><br><br>
  <label>Or upload an HTML file:</label>
  <input type="file" id="htmlFile" accept=".html,.htm">

  <div id="previewContainer">
    <button id="fullscreenBtn">Full Screen</button>
    <iframe id="previewIframe"></iframe>
  </div>
</div>

<!-- Step 3: Upload -->
<div>
  <h2>Step 3: Upload & Convert</h2>
  <button id="uploadBtn" disabled>Upload & Generate Live URL</button>
  <div id="uploadStatus" style="display:none;">Uploading...</div>
</div>

<!-- Step 4: Result -->
<div id="resultContainer" style="display:none;">
  <h2>ðŸŽ‰ Success! Your website is live</h2>
  <div>
    <strong>Live URL:</strong> <a href="#" id="liveUrl" target="_blank"></a>
  </div>
  <button id="copyLiveUrl">Copy Live URL</button>
  <button onclick="window.location.href='we.html'">Go to we.html</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  const htmlInput = document.getElementById('htmlInput');
  const htmlFile = document.getElementById('htmlFile');
  const previewIframe = document.getElementById('previewIframe');
  const uploadBtn = document.getElementById('uploadBtn');
  const uploadStatus = document.getElementById('uploadStatus');
  const resultContainer = document.getElementById('resultContainer');
  const liveUrl = document.getElementById('liveUrl');
  const copyLiveUrl = document.getElementById('copyLiveUrl');
  const fullscreenBtn = document.getElementById('fullscreenBtn');
  const previewContainer = document.getElementById('previewContainer');

  let htmlContent = '';
  let selectedToken = null;

  // Fetch GitHub tokens (only use token1 & token2, random select)
  async function fetchTokens() {
    try {
      const res = await fetch('https://gist.githubusercontent.com/Dtech2preas/8a30b80295920ae54ce13af87b7c162d/raw/gistfile1.txt');
      const text = await res.text();
      const tokens = text.split('\n').map(line => line.trim()).filter(line => line.startsWith('ghp_'));

      if(tokens.length < 2) throw new Error('Need at least 2 tokens');
      
      // pick random between first two tokens
      const chosenIndex = Math.floor(Math.random() * 2); 
      selectedToken = tokens[chosenIndex];

      uploadBtn.disabled = false;
    } catch(err) {
      alert('Error loading tokens: ' + err.message);
    }
  }

  fetchTokens();

  // Update preview
  function updatePreview(content) {
    previewIframe.srcdoc = content;
  }

  // Handle textarea input
  htmlInput.addEventListener('input', () => {
    htmlContent = htmlInput.value;
    updatePreview(htmlContent);
  });

  // Handle file upload
  htmlFile.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if(file) {
      const reader = new FileReader();
      reader.onload = function(ev) {
        htmlContent = ev.target.result;
        updatePreview(htmlContent);
        htmlInput.value = htmlContent;
      };
      reader.readAsText(file);
    }
  });

  // Upload button
  uploadBtn.addEventListener('click', async () => {
    if(!selectedToken) { alert('Token not ready'); return; }
    if(!htmlContent) { alert('Provide HTML content'); return; }

    uploadBtn.disabled = true;
    uploadStatus.style.display = 'block';
    uploadStatus.textContent = 'Uploading...';

    try {
      const gistResponse = await fetch('https://api.github.com/gists', {
        method: 'POST',
        headers: {
          'Authorization': 'token '+selectedToken,
          'Accept': 'application/vnd.github.v3+json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          description: 'Live website ' + new Date().toISOString(),
          public: true,
          files: { 'index.html': { content: htmlContent } }
        })
      });

      const gistData = await gistResponse.json();
      if(!gistData.id) throw new Error(gistData.message || 'Failed to create gist');

      const liveRenderUrl = `https://gist.githack.com/${gistData.owner?.login || 'anonymous'}/${gistData.id}/raw/index.html`;

      liveUrl.textContent = liveRenderUrl;
      liveUrl.href = liveRenderUrl;

      uploadStatus.style.display = 'none';
      resultContainer.style.display = 'block';
    } catch(err) {
      uploadStatus.textContent = 'Error: ' + err.message;
      uploadBtn.disabled = false;
    }
  });

  // Copy live URL
  copyLiveUrl.addEventListener('click', () => {
    navigator.clipboard.writeText(liveUrl.href);
    copyLiveUrl.textContent = 'Copied!';
    setTimeout(()=>{ copyLiveUrl.textContent='Copy Live URL'; }, 2000);
  });

  // Fullscreen toggle
  fullscreenBtn.addEventListener('click', () => {
    if(!document.fullscreenElement) {
      previewContainer.requestFullscreen();
    } else {
      document.exitFullscreen();
    }
  });
});
</script>

</body>
</html>