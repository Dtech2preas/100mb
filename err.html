<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HTML to Live Website Converter</title>
</head>
<body>

<h1>HTML to Live Website Converter</h1>

<!-- Step 1: GitHub Token -->
<div>
  <h2>Step 1: Authentication</h2>
  <label>Select GitHub Token:</label>
  <div id="tokenOptionsContainer">Loading tokens...</div>
  <p>
    Need a token? <a href="https://github.com/settings/tokens/new?description=Gist%20Uploader&scopes=gist" target="_blank">Create one here</a>
  </p>
</div>

<!-- Step 2: Input HTML -->
<div>
  <h2>Step 2: Input HTML</h2>
  <textarea id="htmlInput" rows="15" cols="80" placeholder="Paste your HTML here"></textarea><br><br>
  <label>Or upload an HTML file:</label>
  <input type="file" id="htmlFile" accept=".html,.htm">
  <div>
    <h3>Preview:</h3>
    <pre id="htmlPreview"></pre>
  </div>
</div>

<!-- Step 3: Upload -->
<div>
  <h2>Step 3: Upload & Convert</h2>
  <button id="uploadBtn" disabled>Upload & Generate Live URL</button>
  <div id="uploadStatus" style="display:none;">Uploading...</div>
</div>

<!-- Step 4: Result -->
<div id="resultContainer" style="display:none;">
  <h2>ðŸŽ‰ Success! Your website is live</h2>
  <p>Here are your links:</p>
  <div>
    <strong>Gist URL:</strong> <a href="#" id="gistUrl" target="_blank"></a>
  </div>
  <div>
    <strong>Live URL:</strong> <a href="#" id="liveUrl" target="_blank"></a>
  </div>
  <button id="copyLiveUrl">Copy Live URL</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  const tokenOptionsContainer = document.getElementById('tokenOptionsContainer');
  const htmlInput = document.getElementById('htmlInput');
  const htmlFile = document.getElementById('htmlFile');
  const htmlPreview = document.getElementById('htmlPreview');
  const uploadBtn = document.getElementById('uploadBtn');
  const uploadStatus = document.getElementById('uploadStatus');
  const resultContainer = document.getElementById('resultContainer');
  const gistUrl = document.getElementById('gistUrl');
  const liveUrl = document.getElementById('liveUrl');
  const copyLiveUrl = document.getElementById('copyLiveUrl');

  let htmlContent = '';

  // Fetch tokens
  async function fetchTokens() {
    try {
      const res = await fetch('https://gist.githubusercontent.com/Dtech2preas/8a30b80295920ae54ce13af87b7c162d/raw/gistfile1.txt');
      const text = await res.text();
      const tokens = text.split('\n').map(line => line.trim()).filter(line => line.startsWith('ghp_'));
      if(tokens.length === 0) throw new Error('No valid tokens found');

      tokenOptionsContainer.innerHTML = '';
      tokens.forEach((token, i) => {
        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = 'githubToken';
        radio.value = token;
        radio.id = 'token'+i;
        if(i===0) radio.checked = true;
        const label = document.createElement('label');
        label.htmlFor = 'token'+i;
        label.textContent = 'Token '+(i+1);
        tokenOptionsContainer.appendChild(radio);
        tokenOptionsContainer.appendChild(label);
        tokenOptionsContainer.appendChild(document.createElement('br'));
      });

      uploadBtn.disabled = false;
    } catch(err) {
      tokenOptionsContainer.textContent = 'Error loading tokens: ' + err.message;
    }
  }

  fetchTokens();

  // Handle textarea input
  htmlInput.addEventListener('input', () => {
    htmlContent = htmlInput.value;
    htmlPreview.textContent = htmlContent;
  });

  // Handle file upload
  htmlFile.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if(file) {
      const reader = new FileReader();
      reader.onload = function(ev) {
        htmlContent = ev.target.result;
        htmlPreview.textContent = htmlContent;
      };
      reader.readAsText(file);
    }
  });

  // Upload button
  uploadBtn.addEventListener('click', async () => {
    const tokenInput = document.querySelector('input[name="githubToken"]:checked');
    if(!tokenInput) { alert('Select a token'); return; }
    if(!htmlContent) { alert('Provide HTML content'); return; }

    const token = tokenInput.value;
    uploadBtn.disabled = true;
    uploadStatus.style.display = 'block';
    uploadStatus.textContent = 'Uploading...';

    try {
      const gistResponse = await fetch('https://api.github.com/gists', {
        method: 'POST',
        headers: {
          'Authorization': 'token '+token,
          'Accept': 'application/vnd.github.v3+json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          description: 'Live website ' + new Date().toISOString(),
          public: true,
          files: { 'index.html': { content: htmlContent } }
        })
      });

      const gistData = await gistResponse.json();
      if(!gistData.id) throw new Error(gistData.message || 'Failed to create gist');

      const liveRenderUrl = `https://gist.githack.com/${gistData.owner?.login || 'anonymous'}/${gistData.id}/raw/index.html`;

      gistUrl.textContent = gistData.html_url;
      gistUrl.href = gistData.html_url;
      liveUrl.textContent = liveRenderUrl;
      liveUrl.href = liveRenderUrl;

      uploadStatus.style.display = 'none';
      resultContainer.style.display = 'block';
    } catch(err) {
      uploadStatus.textContent = 'Error: ' + err.message;
      uploadBtn.disabled = false;
    }
  });

  // Copy live URL
  copyLiveUrl.addEventListener('click', () => {
    navigator.clipboard.writeText(liveUrl.href);
    copyLiveUrl.textContent = 'Copied!';
    setTimeout(()=>{ copyLiveUrl.textContent='Copy Live URL'; }, 2000);
  });

});
</script>

</body>
</html>